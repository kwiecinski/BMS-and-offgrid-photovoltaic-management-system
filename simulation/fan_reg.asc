Version 4
SHEET 1 1160 680
WIRE 752 32 48 32
WIRE 688 48 368 48
WIRE 752 48 752 32
WIRE 752 48 736 48
WIRE 784 48 752 48
WIRE 944 48 880 48
WIRE 992 48 944 48
WIRE 1040 48 992 48
WIRE 1104 48 1040 48
WIRE 688 80 688 48
WIRE 752 80 688 80
WIRE 48 96 48 32
WIRE 368 96 368 48
WIRE 1040 112 1040 48
WIRE 1104 128 1104 48
WIRE 592 144 496 144
WIRE 944 144 944 48
WIRE 752 160 752 80
WIRE 752 160 720 160
WIRE 832 160 832 112
WIRE 592 176 576 176
WIRE 736 192 720 192
WIRE 592 208 544 208
WIRE 736 224 736 192
WIRE 944 224 864 224
WIRE 544 272 544 208
WIRE 624 272 544 272
WIRE 832 272 832 160
WIRE 832 272 704 272
WIRE 288 288 48 288
WIRE 448 288 368 288
WIRE 496 288 496 144
WIRE 496 288 448 288
WIRE 48 320 48 288
WIRE 576 368 576 176
WIRE 864 368 864 224
WIRE 864 368 576 368
FLAG 48 400 0
FLAG 48 176 0
FLAG 368 368 0
FLAG 496 352 0
FLAG 944 304 0
FLAG 736 224 0
FLAG 1104 208 0
FLAG 1040 176 0
FLAG 368 176 0
FLAG 992 48 out
FLAG 832 160 base
FLAG 448 288 pwm_filtered
SYMBOL voltage 48 80 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 13.8
SYMBOL voltage 48 304 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 -116 146 Left 2
SYMATTR InstName V2
SYMATTR Value PULSE(0 5 1n 1n 1n  {Tperiod-Ton} {Tperiod})
SYMBOL LM358 624 176 R0
WINDOW 3 56 -85 Top 2
SYMATTR InstName U1
SYMBOL res 384 272 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 2k2
SYMBOL res 352 272 R0
SYMATTR InstName R2
SYMATTR Value 100k
SYMBOL cap 480 288 R0
SYMATTR InstName C1
SYMATTR Value 1µ
SYMBOL npn 784 112 R270
SYMATTR InstName Q1
SYMATTR Value 2SC5866
SYMBOL res 720 256 R90
WINDOW 0 57 65 VBottom 2
WINDOW 3 55 67 VTop 2
SYMATTR InstName R3
SYMATTR Value 1k
SYMBOL res 928 128 R0
SYMATTR InstName R4
SYMATTR Value 10k
SYMBOL res 928 208 R0
SYMATTR InstName R5
SYMATTR Value 6.2k
SYMBOL res 1088 112 R0
SYMATTR InstName R6
SYMATTR Value 24
SYMBOL cap 1024 112 R0
SYMATTR InstName C2
SYMATTR Value 470µ
SYMBOL voltage 368 80 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 28
TEXT 8 424 Left 2 !.tran 0 15m 0 500n
TEXT -448 360 Left 2 !.param duty=0\n.param freq=10k
TEXT -448 432 Left 2 !.param Tperiod={1/freq}\n.param Ton={Tperiod*duty}
